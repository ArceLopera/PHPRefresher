
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PHP and coding refresher.">
      
      
        <meta name="author" content="ArceLopera">
      
      
        <link rel="canonical" href="https://arcelopera.github.io/PHPRefresher/Moodle/API/phpMoodlePersistent/">
      
      <link rel="icon" href="../../../Images/elephant.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Persistent API - PHP Refresher</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#key-features-of-the-persistent-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="PHP Refresher" class="md-header__button md-logo" aria-label="PHP Refresher" data-md-component="logo">
      
  <img src="../../../Images/Elephpant.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PHP Refresher
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Persistent API
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ArceLopera/PHPRefresher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ArceLopera/PHPRefresher
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../phpRefresh/" class="md-tabs__link">
        Basics
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../Func/phpAll/" class="md-tabs__link">
        Functions
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../DS/phpArray/" class="md-tabs__link">
        Data Structures
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../Classes/phpCls/" class="md-tabs__link">
        Classes
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../Adv/phpInclude/" class="md-tabs__link">
        Advanced
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../phpMoodle/" class="md-tabs__link md-tabs__link--active">
        Moodle
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PHP Refresher" class="md-nav__button md-logo" aria-label="PHP Refresher" data-md-component="logo">
      
  <img src="../../../Images/Elephpant.svg" alt="logo">

    </a>
    PHP Refresher
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ArceLopera/PHPRefresher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ArceLopera/PHPRefresher
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Basics" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../phpRefresh/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" data-md-state="indeterminate" type="checkbox" id="__nav_2_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Variables and Assignments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Variables and Assignments" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Variables and Assignments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpVar1/" class="md-nav__link">
        Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpVar2/" class="md-nav__link">
        Data Types and Casting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpVar3/" class="md-nav__link">
        Variable Scope
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpVar4/" class="md-nav__link">
        Variable Handling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpConst/" class="md-nav__link">
        Constant
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpSuperGlobals/" class="md-nav__link">
        Globals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpForms/" class="md-nav__link">
        Forms
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" data-md-state="indeterminate" type="checkbox" id="__nav_2_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          Strings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Strings" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Strings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpStr/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpStr1/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" data-md-state="indeterminate" type="checkbox" id="__nav_2_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7">
          Numbers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Numbers" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          Numbers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpNum1/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpMath1/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpOperators1/" class="md-nav__link">
        Operators
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" data-md-state="indeterminate" type="checkbox" id="__nav_2_9" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9">
          Control Flow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Control Flow" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          Control Flow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpIF/" class="md-nav__link">
        Conditionals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpLoops/" class="md-nav__link">
        Loops
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PR/phpKeywords/" class="md-nav__link">
        Keywords
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Functions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Functions" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Functions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" data-md-state="indeterminate" type="checkbox" id="__nav_3_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Built-in
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Built-in" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Built-in
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpAll/" class="md-nav__link">
        All
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_1_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_2">
          Time n Date
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Time n Date" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Time n Date
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpDate/" class="md-nav__link">
        Date/Time
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpCalendar/" class="md-nav__link">
        Calendar
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpRegex/" class="md-nav__link">
        Regex
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_4" data-md-state="indeterminate" type="checkbox" id="__nav_3_1_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_4">
          Network
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Network" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_4">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpCookie/" class="md-nav__link">
        Cookies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpSessions/" class="md-nav__link">
        Sessions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpFTP/" class="md-nav__link">
        FTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpMail/" class="md-nav__link">
        Mail
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpFilters/" class="md-nav__link">
        Filters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpCallback/" class="md-nav__link">
        Callback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpJSON/" class="md-nav__link">
        JSON
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_8" data-md-state="indeterminate" type="checkbox" id="__nav_3_1_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_8">
          Error and Exceptions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Error and Exceptions" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_8">
          <span class="md-nav__icon md-icon"></span>
          Error and Exceptions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpError/" class="md-nav__link">
        Errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpExceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpConfVar/" class="md-nav__link">
        Config Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpDeclare/" class="md-nav__link">
        Declare
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpEmpty/" class="md-nav__link">
        Empty
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpMisc/" class="md-nav__link">
        Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpOutput/" class="md-nav__link">
        Output Control
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          User-Defined
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User-Defined" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          User-Defined
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpUserFunc/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpArrowFunc/" class="md-nav__link">
        Arrow Function
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Func/phpGenerators/" class="md-nav__link">
        Generators
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Data Structures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Structures" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Data Structures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DS/phpArray/" class="md-nav__link">
        Array
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DS/phpIterables/" class="md-nav__link">
        Iterables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Classes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Classes" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Classes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpCls/" class="md-nav__link">
        OOP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpConstructor/" class="md-nav__link">
        Constructor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpModifiers/" class="md-nav__link">
        Access Modifiers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpInheritance/" class="md-nav__link">
        Inheritance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpConstants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpAbstract/" class="md-nav__link">
        Abstract Classes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpInterfaces/" class="md-nav__link">
        Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpTraits/" class="md-nav__link">
        Traits
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpStatic/" class="md-nav__link">
        Static
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Classes/phpNamespaces/" class="md-nav__link">
        Namespaces
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" data-md-state="indeterminate" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Adv/phpInclude/" class="md-nav__link">
        Include
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Adv/phpGoto/" class="md-nav__link">
        Goto
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" data-md-state="indeterminate" type="checkbox" id="__nav_6_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          File Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="File Management" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          File Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Adv/phpFile/" class="md-nav__link">
        Filesystem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Adv/phpZip/" class="md-nav__link">
        Zip
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Adv/phpMySql/" class="md-nav__link">
        MySQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Adv/phpXML/" class="md-nav__link">
        XML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Adv/phpAjax/" class="md-nav__link">
        Ajax
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Moodle
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Moodle" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Moodle
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodle/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodleInstall/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" data-md-state="indeterminate" type="checkbox" id="__nav_7_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3">
          Plugin Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plugin Types" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Plugin Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodlePluginTypes/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Plugin/phpMoodlePlugin_mod/" class="md-nav__link">
        Activity
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_3" data-md-state="indeterminate" type="checkbox" id="__nav_7_3_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_3">
          Question
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Question" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_3_3">
          <span class="md-nav__icon md-icon"></span>
          Question
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Plugin/phpMoodlePlugin_qtypes/" class="md-nav__link">
        Question Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Plugin/phpMoodlePlugin_qformat/" class="md-nav__link">
        Question Format
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Plugin/phpMoodlePlugin_qbank/" class="md-nav__link">
        Question Bank
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Plugin/phpMoodlePlugin_qbehavior/" class="md-nav__link">
        Question Behavior
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Plugin/phpMoodlePlugin_booktool/" class="md-nav__link">
        Book Tool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Plugin/phpMoodlePlugin_datafield/" class="md-nav__link">
        Database Fields
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodlePluginSkeleton/" class="md-nav__link">
        Skeleton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodlePluginFiles/" class="md-nav__link">
        Common Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodleXMLDB/" class="md-nav__link">
        XMLDB Editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodleTemplate/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_8" data-md-state="indeterminate" type="checkbox" id="__nav_7_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_8">
          Javascript
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Javascript" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_8">
          <span class="md-nav__icon md-icon"></span>
          Javascript
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Javascript/phpMoodleJS/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Javascript/phpMoodleJSTools/" class="md-nav__link">
        Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Javascript/phpMoodlePromises/" class="md-nav__link">
        Promises
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Javascript/phpMoodleModal/" class="md-nav__link">
        Modal Dialogues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Javascript/phpMoodleAJAX/" class="md-nav__link">
        AJAX
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_9" type="checkbox" id="__nav_7_9" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_9">
          APIs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="APIs" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_9">
          <span class="md-nav__icon md-icon"></span>
          APIs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodleServices/" class="md-nav__link">
        External Services
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Persistent API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Persistent API
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features-of-the-persistent-api" class="md-nav__link">
    Key Features of the Persistent API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-persistent-class" class="md-nav__link">
    Creating a Persistent Class
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-components" class="md-nav__link">
    Key Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-operations-with-persistent-api" class="md-nav__link">
    Basic Operations with Persistent API
  </a>
  
    <nav class="md-nav" aria-label="Basic Operations with Persistent API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-record" class="md-nav__link">
    Creating a Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-a-record" class="md-nav__link">
    Retrieving a Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-a-record" class="md-nav__link">
    Updating a Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-a-record" class="md-nav__link">
    Deleting a Record
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-features" class="md-nav__link">
    Other Features
  </a>
  
    <nav class="md-nav" aria-label="Other Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetching-records" class="md-nav__link">
    Fetching Records
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-fetching" class="md-nav__link">
    Custom fetching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transactions" class="md-nav__link">
    Transactions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-data" class="md-nav__link">
    Validating Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extending-persistent-classes" class="md-nav__link">
    Extending Persistent Classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    Hooks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-persistent-api-with-forms" class="md-nav__link">
    Integrating Persistent API with Forms
  </a>
  
    <nav class="md-nav" aria-label="Integrating Persistent API with Forms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    Key Features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-to-use-coreformpersistent" class="md-nav__link">
    Steps to Use core\form\persistent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreign-fields" class="md-nav__link">
    Foreign fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grouping-fields" class="md-nav__link">
    Grouping fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimalist" class="md-nav__link">
    Minimalist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-advanced" class="md-nav__link">
    More advanced
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-form" class="md-nav__link">
    Using the form
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleExporter/" class="md-nav__link">
        Exporter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleQuestion/" class="md-nav__link">
        Question API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleDM/" class="md-nav__link">
        Data Manipulation API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleTag/" class="md-nav__link">
        Tag API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleAccess/" class="md-nav__link">
        Access API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleGroups/" class="md-nav__link">
        Groups API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleMessage/" class="md-nav__link">
        Messaging API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleCache/" class="md-nav__link">
        Cache API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phpMoodleTable/" class="md-nav__link">
        Table API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../phpMoodleSecurity/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features-of-the-persistent-api" class="md-nav__link">
    Key Features of the Persistent API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-persistent-class" class="md-nav__link">
    Creating a Persistent Class
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-components" class="md-nav__link">
    Key Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-operations-with-persistent-api" class="md-nav__link">
    Basic Operations with Persistent API
  </a>
  
    <nav class="md-nav" aria-label="Basic Operations with Persistent API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-record" class="md-nav__link">
    Creating a Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-a-record" class="md-nav__link">
    Retrieving a Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-a-record" class="md-nav__link">
    Updating a Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-a-record" class="md-nav__link">
    Deleting a Record
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-features" class="md-nav__link">
    Other Features
  </a>
  
    <nav class="md-nav" aria-label="Other Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetching-records" class="md-nav__link">
    Fetching Records
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-fetching" class="md-nav__link">
    Custom fetching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transactions" class="md-nav__link">
    Transactions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-data" class="md-nav__link">
    Validating Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extending-persistent-classes" class="md-nav__link">
    Extending Persistent Classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    Hooks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-persistent-api-with-forms" class="md-nav__link">
    Integrating Persistent API with Forms
  </a>
  
    <nav class="md-nav" aria-label="Integrating Persistent API with Forms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    Key Features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-to-use-coreformpersistent" class="md-nav__link">
    Steps to Use core\form\persistent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreign-fields" class="md-nav__link">
    Foreign fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grouping-fields" class="md-nav__link">
    Grouping fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimalist" class="md-nav__link">
    Minimalist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-advanced" class="md-nav__link">
    More advanced
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-form" class="md-nav__link">
    Using the form
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Persistent API</h1>

<p>The Persistent API in Moodle is a framework that simplifies the handling of data records, particularly when dealing with the database. It provides a structured way to interact with database tables, making it easier to create, update, retrieve, and delete records while ensuring data integrity and consistency.</p>
<h3 id="key-features-of-the-persistent-api">Key Features of the Persistent API</h3>
<ol>
<li>
<p><strong>Encapsulation of Data Logic</strong>: The API encapsulates the logic related to data operations, meaning you work with objects representing your data rather than writing SQL queries directly.</p>
</li>
<li>
<p><strong>Automatic Data Validation</strong>: The Persistent API automatically validates data before it is inserted or updated in the database, ensuring that only valid data is stored.</p>
</li>
<li>
<p><strong>Easier Maintenance</strong>: By using a consistent interface for data manipulation, the Persistent API makes your code more maintainable and less prone to errors.</p>
</li>
<li>
<p><strong>Supports Transactions</strong>: The API supports database transactions, allowing multiple operations to be performed atomically.</p>
</li>
</ol>
<h3 id="creating-a-persistent-class">Creating a Persistent Class</h3>
<p>To use the Persistent API, you define a class that extends <code>core\persistent</code>. This class represents a table in the database and encapsulates all the operations that can be performed on that table.</p>
<h5 id="example-structure-of-a-persistent-class">Example Structure of a Persistent Class</h5>
<div class="highlight"><pre><span></span><code><span class="x">namespace local_yourplugin;</span>

<span class="x">use core\persistent;</span>

<span class="x">class example extends persistent {</span>

<span class="x">    // Define the table name associated with this persistent class</span>
<span class="x">    const TABLE = &#39;local_yourplugin_example&#39;;</span>

<span class="x">    // Define the properties (fields) of the persistent class</span>
<span class="x">    protected static function define_properties() {</span>
<span class="x">        return [</span>
<span class="x">            &#39;name&#39; =&gt; [</span>
<span class="x">                &#39;type&#39; =&gt; PARAM_TEXT,</span>
<span class="x">                &#39;default&#39; =&gt; &#39;&#39;,</span>
<span class="x">            ],</span>
<span class="x">            &#39;description&#39; =&gt; [</span>
<span class="x">                &#39;type&#39; =&gt; PARAM_TEXT,</span>
<span class="x">                &#39;default&#39; =&gt; &#39;&#39;,</span>
<span class="x">            ],</span>
<span class="x">            &#39;timecreated&#39; =&gt; [</span>
<span class="x">                &#39;type&#39; =&gt; PARAM_INT,</span>
<span class="x">                &#39;default&#39; =&gt; 0,</span>
<span class="x">            ],</span>
<span class="x">            &#39;timemodified&#39; =&gt; [</span>
<span class="x">                &#39;type&#39; =&gt; PARAM_INT,</span>
<span class="x">                &#39;default&#39; =&gt; 0,</span>
<span class="x">            ],</span>
<span class="x">        ];</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<h3 id="key-components">Key Components</h3>
<ol>
<li>
<p><strong>Table Definition</strong>: 
    The <code>const TABLE</code> constant defines the name of the database table that this persistent class represents. While the persistent class is helpful for database interactions, it does not automatically fetch the properties from the database, nor does it create the tables. You will need to create the table yourself, as well as pointing the persistent to it. This can be done by defining the class constant TABLE.</p>
<p><div class="highlight"><pre><span></span><code><span class="x">/** Table name for the persistent. */</span>
<span class="x">const TABLE = &#39;status&#39;;</span>
</code></pre></div>
The table name must not contain the Moodle prefix. Also it is common practice to always refer to your table name using the constant.</p>
</li>
<li>
<p><strong>Property Definitions</strong>: 
    The <code>define_properties()</code> method returns an array of fields that map to the columns in the database table. Each field is described by its type (e.g., <code>PARAM_TEXT</code>, <code>PARAM_INT</code>), default value, and other properties attributes.</p>
</li>
<li>
<p><strong>Properties attributes</strong>:</p>
<ul>
<li><strong>type</strong>
    The only mandatory attribute. It must be one of the many PARAM_* constants.</li>
<li><strong>default</strong>
    The default value to attach to the property when it hasn't been provided. Without a default, the property's value is required. Alternatively this can be a Closure returning the default value.</li>
<li><strong>null</strong>
    Either of the constants NULL_ALLOWED or NULL_NOT_ALLOWED determining if the null value is accepted. This defaults to NULL_NOT_ALLOWED.</li>
<li><strong>message</strong>
    The default error message (as a lang_string instance) to return when the validation of this field fails.</li>
<li><strong>choices</strong>
    An array of values which the property must fall in.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="x">&#39;messageformat&#39; =&gt; [</span>
<span class="x">    &#39;type&#39; =&gt; PARAM_INT,</span>
<span class="x">    &#39;default&#39; =&gt; FORMAT_PLAIN,</span>
<span class="x">    &#39;choices&#39; =&gt; [FORMAT_PLAIN, FORMAT_HTML, FORMAT_MOODLE, FORMAT_MARKDOWN]</span>
<span class="x">],</span>
<span class="x">&#39;location&#39; =&gt; [</span>
<span class="x">    &#39;type&#39; =&gt; PARAM_ALPHANUMEXT,</span>
<span class="x">    &#39;null&#39; =&gt; NULL_ALLOWED,</span>
<span class="x">    &#39;message&#39; =&gt; new lang_string(&#39;invaliddata&#39;, &#39;error&#39;),</span>
<span class="x">    &#39;default&#39; =&gt; function() {</span>
<span class="x">        return get_config(&#39;core&#39;, &#39;default_location&#39;);</span>
<span class="x">    },</span>
<span class="x">]</span>
</code></pre></div>
<p>Note that you should always use a Closure for the default value when you cannot guarantee that it will not change since the start of the request. The list of properties and their attributes is cached, and so failure to use a Closure can result in using an outdated default value.</p>
</li>
<li>
<p><strong>Mandatory properties</strong>:</p>
<p>Four fields are always added to your persistent and should be reflected in your database table. You must not define those properties in define_properties():</p>
<ul>
<li><strong>id (non-null integer)</strong>:
    The primary key of the record.</li>
<li><strong>usermodified (non-null integer)</strong>:
    The user who created/modified the object. It is automatically set.</li>
<li><strong>timecreated (non-null integer)</strong>:
    The timestamp at which the record was modified. It is automatically set.</li>
<li><strong>timemodified (non-null integer)</strong>:
    The timestamp at which the record was modified. It is automatically set, and defaults to 0.</li>
</ul>
<p>From Moodle 3.7 onwards, the XMLDB tool has an option to add these fields to your table.</p>
</li>
</ol>
<h3 id="basic-operations-with-persistent-api">Basic Operations with Persistent API</h3>
<p>Once your persistent class is defined, you can easily perform CRUD (Create, Read, Update, Delete) operations.</p>
<h4 id="creating-a-record">Creating a Record</h4>
<p>To create a new record in the database:</p>
<div class="highlight"><pre><span></span><code><span class="x">$record = new example(0, (object)[</span>
<span class="x">    &#39;name&#39; =&gt; &#39;Example Name&#39;,</span>
<span class="x">    &#39;description&#39; =&gt; &#39;Example description.&#39;,</span>
<span class="x">]);</span>

<span class="x">$record-&gt;create();</span>
</code></pre></div>
<h4 id="retrieving-a-record">Retrieving a Record</h4>
<p>This can be done using the method get(). Alternatively you can also use to_record() which exports the whole object.
To retrieve a record by its ID:</p>
<div class="highlight"><pre><span></span><code><span class="x">$record = new example($id);</span>
<span class="x">echo $record-&gt;get(&#39;name&#39;);</span>

<span class="x">// or</span>
<span class="x">$record = $record-&gt;to_record();</span>
</code></pre></div>
<p>You may add a new custom getter to implement your own custom logic. To do this just add a new method get_propertyname() and it will be called from the generic get() method. For instance you could convert the data in another format automatically as a convenience for developers. However, use this sparingly as it may lead to confusion: what you get is not what is stored in the database. Also - to get the actual value from a custom getter - call raw_get(). Calling get() from a custom getter will generate a segfault due to infinite recursion.</p>
<p>It is, however, encouraged to add convenience methods such as the following:</p>
<div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * Returns the user object of the author.</span>
<span class="x"> *</span>
<span class="x"> * @return stdClass</span>
<span class="x"> */</span>
<span class="x">public function get_author() {</span>
<span class="x">    return core_user::get_user($this-&gt;get(&#39;userid&#39;));</span>
<span class="x">}</span>
</code></pre></div>
<h4 id="updating-a-record">Updating a Record</h4>
<p>There are two ways to do so.</p>
<p>You use an object (stdClass) to assign a bunch of properties at once. Use it with the constructor, or the method from_record(). Or, you can use the magic setters set_ followed by the property name.
To update an existing record:</p>
<div class="highlight"><pre><span></span><code><span class="x">$record = new example($id);</span>
<span class="x">$record-&gt;set(&#39;name&#39;, &#39;Updated Name&#39;);</span>
<span class="x">$record-&gt;update();</span>

<span class="x">// or</span>
<span class="x">$record-&gt;from_record($record-&gt;get_record());</span>
</code></pre></div>
<p>Though you don't have to for the code to work, you can define your own setter methods which will be called from the generic setter. This is useful if you want to extract the data out of a more complex object prior to assigning it. Though note that those setters will then have to use the raw_set() method to assign the values (if you do not you will see a segfault because of infinite recursion).</p>
<div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * Convenience method to set the user ID.</span>
<span class="x"> *</span>
<span class="x"> * @param object|int $idorobject The user ID, or a user object.</span>
<span class="x"> */</span>
<span class="x">public function set_userid($idorobject) {</span>
<span class="x">    $userid = $idorobject;</span>
<span class="x">    if (is_object($idorobject)) {</span>
<span class="x">        $userid = $idorobject-&gt;id;</span>
<span class="x">    }</span>
<span class="x">    $this-&gt;raw_set(&#39;userid&#39;, $userid);</span>
<span class="x">}</span>
</code></pre></div>
<p>In the above example we will accept an object or an ID, as a convenience for developers we will extract the ID value out of the object passed if any.</p>
<p>Just like custom getters, must be careful so that the following code should not result in a change in the DB.</p>
<div class="highlight"><pre><span></span><code><span class="x">$value = $persistent-&gt;get(&#39;property&#39;);</span>
<span class="x">$persistent-&gt;set(&#39;property&#39;, $value);</span>
<span class="x">$persistent-&gt;update();</span>
</code></pre></div>
<p>You can obviously create your own setters which aren't based on any properties just as a convenience. For instance we could have created set_userid_from_user(object $user) which is more verbose and more predictable</p>
<h4 id="deleting-a-record">Deleting a Record</h4>
<p>To delete a record:</p>
<p><div class="highlight"><pre><span></span><code><span class="x">$record = new example($id);</span>
<span class="x">$record-&gt;delete();</span>
</code></pre></div>
The methods to create, read, update and delete are eponymous. Your object will be validated before you create or update it. The update, delete and read methods require your object to contain its ID. And you also won't be allowed to create an entry which already had an ID defined.</p>
<p>Here are some code examples:</p>
<div class="highlight"><pre><span></span><code><span class="x">// Fetches an object from database based on its ID.</span>
<span class="x">$id = 123;</span>
<span class="x">$persistent = new status($id);</span>

<span class="x">// Create object in the database.</span>
<span class="x">$data = new stdClass();</span>
<span class="x">$data-&gt;message = &#39;Hello new world&#39;;</span>
<span class="x">$persistent = new persistent(0, $data);</span>
<span class="x">$persistent-&gt;create();</span>
<span class="x">// $persistent-&gt;get(&#39;id&#39;) will now return an id.</span>

<span class="x">// Load an object from the database, and update it.</span>
<span class="x">$id = 123;</span>
<span class="x">$persistent = new status($id);</span>
<span class="x">$persistent-&gt;set(&#39;message&#39;, &#39;Hello new world!&#39;);</span>
<span class="x">$persistent-&gt;update();</span>

<span class="x">// Reset the instance to the values in the database.</span>
<span class="x">$persistent-&gt;read();</span>

<span class="x">// Permanently delete the object from the database.</span>
<span class="x">$persistent-&gt;delete();</span>
</code></pre></div>
<h3 id="other-features">Other Features</h3>
<h4 id="fetching-records">Fetching Records</h4>
<p>Once you start using persistents you should never directly interact with the database outside of your class. The persistent class comes with a few handy methods allowing you to retrieve your objects.</p>
<p><div class="highlight"><pre><span></span><code><span class="x">// Use the constructor to fetch one object from its ID.</span>
<span class="x">$persistent = new status($id);</span>

<span class="x">// Get one record from a set of conditions.</span>
<span class="x">$persistent = status::get_record([&#39;userid&#39; =&gt; $userid, &#39;message&#39; =&gt; &#39;Hello world!&#39;]);</span>

<span class="x">// Get multiple records from a set of conditions.</span>
<span class="x">$persistents = status::get_records([&#39;userid&#39; =&gt; $userid]);</span>

<span class="x">// Count the records.</span>
<span class="x">$count = status::count_records([&#39;userid&#39; =&gt; $userid]);</span>

<span class="x">// Check whether a record exists.</span>
<span class="x">$exists = status::record_exists($id);</span>
</code></pre></div>
Make sure to also check their additional parameters and their variants <code>(record_exists_select(), count_records_select, get_records_select, ...)</code>.</p>
<h4 id="custom-fetching">Custom fetching</h4>
<p>It's always a good idea to add more complex queries directly within your persistent. By convention you should always return an instance of your persistent and never an stdClass. Here we add a custom method which allows to directly fetch all records by username.</p>
<p><div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * Get all records from a user&#39;s username.</span>
<span class="x"> *</span>
<span class="x"> * @param string $username The username.</span>
<span class="x"> * @return status[]</span>
<span class="x"> */</span>
<span class="x">public static function get_records_by_username($username) {</span>
<span class="x">    global $DB;</span>

<span class="x">    $sql = &#39;SELECT s.*</span>
<span class="x">              FROM {&#39; . static::TABLE . &#39;} s</span>
<span class="x">              JOIN {user} u</span>
<span class="x">                ON u.id = s.userid</span>
<span class="x">             WHERE u.username = :username&#39;;</span>

<span class="x">    $persistents = [];</span>

<span class="x">    $recordset = $DB-&gt;get_recordset_sql($sql, [&#39;username&#39; =&gt; $username]);</span>
<span class="x">    foreach ($recordset as $record) {</span>
<span class="x">        $persistents[] = new static(0, $record);</span>
<span class="x">    }</span>
<span class="x">    $recordset-&gt;close();</span>

<span class="x">    return $persistents;</span>
<span class="x">}</span>
</code></pre></div>
If you need to join persistents together and be able to extract their respective properties in a single database query, you should have a look at the following methods:</p>
<ul>
<li>
<p><strong>get_sql_fields(string $alias, string $prefix = null)</strong></p>
<p>Returns the SQL statement to include in the SELECT clause to prefix columns.</p>
</li>
<li>
<p><strong>extract_record(stdClass $row, string $prefix = null)</strong></p>
<p>Extracts all the properties from a row based on the given prefix.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="x">// Minimalist example.</span>
<span class="x">$sqlfields = status::get_sql_fields(&#39;s&#39;, &#39;statprops&#39;);</span>
<span class="x">$sql = &quot;SELECT $sqlfields, u.username</span>
<span class="x">          FROM {&quot; . status::TABLE . &quot;} s</span>
<span class="x">          JOIN {user} ON s.userid = u.id</span>
<span class="x">         WHERE s.id = 1&quot;;</span>
<span class="x">$row = $DB-&gt;get_record($sql, []);</span>
<span class="x">$statusdata = status::extract_record($row, &#39;statprops&#39;);</span>
<span class="x">$persistent = new status(0, $statusdata);</span>
</code></pre></div>
<h4 id="transactions">Transactions</h4>
<p>If you need to perform multiple database operations that should be treated as a single transaction:</p>
<div class="highlight"><pre><span></span><code><span class="x">$transaction = $DB-&gt;start_delegated_transaction();</span>

<span class="x">try {</span>
<span class="x">    $record1 = new example(0, $data1);</span>
<span class="x">    $record1-&gt;create();</span>

<span class="x">    $record2 = new example(0, $data2);</span>
<span class="x">    $record2-&gt;create();</span>

<span class="x">    $transaction-&gt;allow_commit();</span>
<span class="x">} catch (\Exception $e) {</span>
<span class="x">    $transaction-&gt;rollback($e);</span>
<span class="x">    throw $e;</span>
<span class="x">}</span>
</code></pre></div>
<h4 id="validating-data">Validating Data</h4>
<p>The Persistent API automatically validates data based on the property definitions. However, you can add custom validation logic by overriding the <code>validate()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="x">protected function validate() {</span>
<span class="x">    $errors = parent::validate();</span>

<span class="x">    if ($this-&gt;get(&#39;name&#39;) === &#39;&#39;) {</span>
<span class="x">        $errors[&#39;name&#39;] = &#39;Name cannot be empty&#39;;</span>
<span class="x">    }</span>

<span class="x">    return $errors;</span>
<span class="x">}</span>
</code></pre></div>
<p>Basic validation of the properties values happens automatically based on their type (PARAM_* constant), however this is not always enough. In order to implement your own custom validation, simply define a protected method starting with validate_ followed with the property name. This method will be called whenever the model needs to be validated and will receive the data to validate.</p>
<p>A validation method must always return either true or an instance of lang_string which contains the error message to send to the user.</p>
<div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * Validate the user ID.</span>
<span class="x"> *</span>
<span class="x"> * @param int $value The value.</span>
<span class="x"> * @return true|lang_string</span>
<span class="x"> */</span>
<span class="x">protected function validate_userid($value) {</span>
<span class="x">    if (!core_user::is_real_user($value, true)) {</span>
<span class="x">        return new lang_string(&#39;invaliduserid&#39;, &#39;error&#39;);</span>
<span class="x">    }</span>

<span class="x">    return true;</span>
<span class="x">}</span>
</code></pre></div>
<p>The above example ensures that the userid property contains a valid user ID.</p>
<p>Note that the basic validation is always performed first, and thus your custom validation method will not be called when the value did not pass the basic validation.</p>
<h5 id="validation-results">Validation results</h5>
<p>The validation of the object automatically happens upon create and update. If the validation did not pass, an invalid_persistent_exception will be raised. You can validate the object prior to saving the object and get the validation results if you need to.</p>
<div class="highlight"><pre><span></span><code><span class="x">// We can catch the invalid_persistent_exception.</span>
<span class="x">try {</span>
<span class="x">    $persistent = new status();</span>
<span class="x">    $persistent-&gt;create();</span>
<span class="x">} catch (invalid_persistent_exception $e) {</span>
<span class="x">    // Whoops, something wrong happened.</span>
<span class="x">}</span>

<span class="x">// Check whether the object is valid.</span>
<span class="x">$persistent-&gt;is_valid();        // True or false.</span>

<span class="x">// Get the validation errors.</span>
<span class="x">$persistent-&gt;get_errors();      // Array where keys are properties and values are errors.</span>

<span class="x">// Validate the object.</span>
<span class="x">$persistent-&gt;validate();        // Returns true, or an array of errors.</span>
</code></pre></div>
<h4 id="extending-persistent-classes">Extending Persistent Classes</h4>
<p>You must never extend the persistent classes to add more complex functionality specific to your plugin. Do not do the following:</p>
<div class="highlight"><pre><span></span><code><span class="x">class advanced_example extends example {</span>
<span class="x">    public function custom_function() {</span>
<span class="x">        // Custom logic here</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<h5 id="common-pitfalls">Common pitfalls</h5>
<ul>
<li>You must create the database table yourself, using the XMLDB editor and an upgrade script.</li>
<li>You must include the mandatory fields in your table schema.</li>
<li><strong>You must never extend another persistent as this leads to unpredictable errors whenever the parent changes (new properties missing in your table, changes in validation, custom getters and setters, etc...).</strong></li>
</ul>
<h3 id="hooks">Hooks</h3>
<p>You can define the following methods to be notified prior to, or after, something happened:</p>
<ul>
<li>
<p><strong>protected before_validate()</strong></p>
<p>Do something before the object is validated.</p>
</li>
<li>
<p><strong>protected before_create()</strong></p>
<p>Do something before the object is inserted in the database. Note that values assigned to properties are not longer validated at this point.</p>
</li>
<li>
<p><strong>protected after_create()</strong></p>
<p>Do something right after the object was added to the database.</p>
</li>
<li>
<p><strong>protected before_update()</strong></p>
<p>Do something before the object is updated in the database. Note that values assigned to properties are not longer validated at this point.</p>
</li>
<li>
<p><strong>protected after_update(bool $result)</strong></p>
<p>Do something right after the object was updated in the database.</p>
</li>
<li>
<p><strong>protected before_delete()</strong></p>
<p>Do something right before the object is deleted from the database.</p>
</li>
<li>
<p><strong>protected after_delete(bool $result)</strong></p>
<p>Do something right after the object was deleted from the database.</p>
</li>
</ul>
<h3 id="integrating-persistent-api-with-forms">Integrating Persistent API with Forms</h3>
<p>The <code>core\form\persistent</code> class in Moodle provides a streamlined way to integrate Moodle forms with the Persistent API. It allows developers to create forms that directly interact with persistent classes, simplifying the process of handling form data, validation, and database operations.</p>
<h4 id="key-features">Key Features</h4>
<ol>
<li>
<p><strong>Form Integration with Persistent Classes:</strong>
    The <code>core\form\persistent</code> class connects Moodle forms with persistent classes, ensuring that form submissions are directly mapped to the corresponding database records.</p>
</li>
<li>
<p><strong>Automatic Data Handling:</strong>
    Data entered in the form is automatically populated into the persistent class, reducing the need for manual data handling.</p>
</li>
<li>
<p><strong>Validation Consistency:</strong>
    Form validation is tightly coupled with the validation logic defined in the persistent class, ensuring consistency across your application.</p>
</li>
<li>
<p><strong>Simplified CRUD Operations:</strong>
    CRUD operations are simplified, as the form directly interacts with the persistent class, handling the creation, updating, or deletion of records.</p>
</li>
</ol>
<h4 id="steps-to-use-coreformpersistent">Steps to Use <code>core\form\persistent</code></h4>
<ol>
<li>
<p><strong>Create a Persistent Class:</strong></p>
<p>First, define a persistent class representing the database table you want to interact with.</p>
<div class="highlight"><pre><span></span><code><span class="x">namespace local_yourplugin;</span>

<span class="x">use core\persistent;</span>

<span class="x">defined(&#39;MOODLE_INTERNAL&#39;) || die();</span>

<span class="x">class example extends persistent {</span>
<span class="x">    const TABLE = &#39;local_yourplugin_example&#39;;</span>

<span class="x">    protected static function define_properties() {</span>
<span class="x">        return [</span>
<span class="x">            &#39;name&#39; =&gt; [</span>
<span class="x">                &#39;type&#39; =&gt; PARAM_TEXT,</span>
<span class="x">                &#39;default&#39; =&gt; &#39;&#39;,</span>
<span class="x">            ],</span>
<span class="x">            &#39;description&#39; =&gt; [</span>
<span class="x">                &#39;type&#39; =&gt; PARAM_TEXT,</span>
<span class="x">                &#39;default&#39; =&gt; &#39;&#39;,</span>
<span class="x">            ],</span>
<span class="x">        ];</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Create a Form Class Extending <code>core\form\persistent</code>:</strong></p>
<p>Next, create a form class that extends <code>core\form\persistent</code>. This class will handle the form display, validation, and data processing.</p>
<div class="highlight"><pre><span></span><code><span class="x">namespace local_yourplugin\form;</span>

<span class="x">use core\form\persistent;</span>

<span class="x">defined(&#39;MOODLE_INTERNAL&#39;) || die();</span>

<span class="x">class example_form extends persistent {</span>

<span class="x">    /** @var string Persistent class name. */</span>
<span class="x">    protected static $persistentclass = &#39;local_yourplugin\example&#39;;</span>

<span class="x">    protected function definition() {</span>
<span class="x">        $mform = $this-&gt;_form;</span>

<span class="x">        $mform-&gt;addElement(&#39;text&#39;, &#39;name&#39;, get_string(&#39;name&#39;, &#39;local_yourplugin&#39;));</span>
<span class="x">        $mform-&gt;addRule(&#39;name&#39;, get_string(&#39;required&#39;), &#39;required&#39;, null, &#39;client&#39;);</span>

<span class="x">        $mform-&gt;addElement(&#39;textarea&#39;, &#39;description&#39;, get_string(&#39;description&#39;, &#39;local_yourplugin&#39;));</span>

<span class="x">         // User ID.</span>
<span class="x">        $mform-&gt;addElement(&#39;hidden&#39;, &#39;userid&#39;);</span>
<span class="x">        $mform-&gt;setConstant(&#39;userid&#39;, $this-&gt;_customdata[&#39;userid&#39;]);</span>

<span class="x">        // Message.</span>
<span class="x">        $mform-&gt;addElement(&#39;editor&#39;, &#39;message&#39;, &#39;Message&#39;);</span>

<span class="x">        // Location.</span>
<span class="x">        $mform-&gt;addElement(&#39;text&#39;, &#39;location&#39;, &#39;Location&#39;);</span>

<span class="x">        $this-&gt;add_action_buttons();</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<ul>
<li><strong><code>$persistentclass</code>:</strong> This specifies the persistent class that the form is linked to. In order for the form class to know what persistent we'll be dealing with, we must declare the protected static $persistentclass variable. The latter contains the fully qualified name of the persistent class.</li>
<li><strong><code>definition()</code>:</strong> This method defines the form fields, linking them directly to the properties of the persistent class. All of this is pretty standard, except for the userid. When creating a new 'status', we do not want our users to be in control of this value. Therefore we define it as a hidden value which we lock (using setConstant) to the value we created our form with. All the mandatory fields (without a default value) of the persistent need to be added to the form. If your users cannot change their values, then they must be hidden and locked with setConstant. Did you notice that there isn't any call to setType in the above example? That is because we automatically do it for you based on the field name and your persistent's properties.Also note that the id property is not included. It is not required, nor recommended, to add it to your fields as it will be handled automatically.</li>
</ul>
</li>
<li>
<p><strong>Using the Form in Your Plugin:</strong></p>
<p>When instantiating the form, there are two little things that you need to pay attention to.</p>
<p>Firstly you should always pass the URL of the current page, including its query parameters. We need this to be able to display the form with its validation errors without affecting anything else.</p>
<p>Secondly, the persistent instance must be provided to the form through the custom data. That persistent instance will be used to populate the form with initial data, typically when you are editing an object. When you don't have a persistent instance yet, probably because your user will be creating a new one, then simply pass null.</p>
<p><div class="highlight"><pre><span></span><code><span class="x">$customdata = [</span>
<span class="x">&#39;persistent&#39; =&gt; $persistent,  // An instance, or null.</span>
<span class="x">&#39;userid&#39; =&gt; $USER-&gt;id         // For the hidden userid field.</span>
<span class="x">];</span>
<span class="x">$form = new status_form($PAGE-&gt;url-&gt;out(false), $customdata);</span>
</code></pre></div>
Just like any other form, we will be using get_data() to validate the form. The only difference is that to determine whether we are editing an object, or creating a new one, we will check if the id value was returned to us. The persistent form will return the ID value from the persistent we gave it. Then it's up to you to decide how to apply the data, most likely you will defer the logic to another part of your code, one that ensures that all capability checks are fulfilled. To use the form in your plugin, create an instance of the form and process it like this:</p>
<div class="highlight"><pre><span></span><code><span class="x">$form = new \local_yourplugin\form\example_form();</span>

<span class="x">if ($form-&gt;is_cancelled()) {</span>
<span class="x">    // Handle form cancellation (e.g., redirect to another page).</span>
<span class="x">} else  if (($data = $form-&gt;get_data())) { </span>
<span class="x">    // Get the data. This ensures that the form was validated.</span>

<span class="x">    if (empty($data-&gt;id)) {</span>
<span class="x">        // If we don&#39;t have an ID, we know that we must create a new record.</span>
<span class="x">        // Call your API to create a new persistent from this data.</span>
<span class="x">        // Or, do the following if you don&#39;t want capability checks (discouraged).</span>
<span class="x">        $persistent = new status(0, $data);</span>
<span class="x">        $persistent-&gt;create();</span>
<span class="x">    } else {</span>
<span class="x">        // We had an ID, this means that we are going to update a record.</span>
<span class="x">        // Call your API to update the persistent from the data.</span>
<span class="x">        // Or, do the following if you don&#39;t want capability checks (discouraged).</span>
<span class="x">        $persistent-&gt;from_record($data);</span>
<span class="x">        $persistent-&gt;update();</span>
<span class="x">    }</span>

<span class="x">    // We are done, so let&#39;s redirect somewhere.</span>
<span class="x">    redirect(new moodle_url(&#39;/&#39;));</span>
<span class="x">}</span>

<span class="x">echo $OUTPUT-&gt;header();</span>
<span class="x">$form-&gt;display();</span>
<span class="x">echo $OUTPUT-&gt;footer();</span>
</code></pre></div>
<ul>
<li><strong><code>is_cancelled()</code>:</strong> Checks if the form was canceled by the user.</li>
<li><strong><code>get_data()</code>:</strong> Retrieves the form data.</li>
</ul>
</li>
</ol>
<h5 id="additional-validation">Additional Validation</h5>
<p>There are times when the built-in validation of the persistent is not enough. Usually you would use the method validation(), but as the form persistent class does some extra stuff to make it easier for you, you must use the extra_validation() method. The latter works almost just like the validation() one.</p>
<p><div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * Extra validation.</span>
<span class="x"> *</span>
<span class="x"> * @param  stdClass $data Data to validate.</span>
<span class="x"> * @param  array $files Array of files.</span>
<span class="x"> * @param  array $errors Currently reported errors.</span>
<span class="x"> * @return array of additional errors, or overridden errors.</span>
<span class="x"> */</span>
<span class="x">protected function extra_validation($data, $files, array &amp;$errors) {</span>
<span class="x">    $newerrors = array();</span>

<span class="x">    if ($data-&gt;location === &#39;SFO&#39;) {</span>
<span class="x">        $newerrors[&#39;location&#39;] = &#39;San-Francisco Airport is not accepted from the form.&#39;;</span>
<span class="x">    }</span>

<span class="x">    return $newerrors;</span>
<span class="x">}</span>
</code></pre></div>
The typical additional validation will return an array of errors, those will override any previously defined errors. Sometimes, though rarely, you will need to remove previously reported errors, hence the reference to $errors given, which you can modify directly. Do not abuse it though, this should only be used when you have no other choice.</p>
<h4 id="foreign-fields">Foreign fields</h4>
<p>By default, the form class tries to be smart at detecting foreign fields such as the submit button. Failure to do so will cause troubles during validation, or when getting the data. So when your form becomes more complex, if it includes more submit buttons, or when it deals with other fields, for example file managers, we must indicate it.</p>
<h5 id="fields-to-ignore-completely">Fields to ignore completely</h5>
<p>The fields to remove are never validated and they are not returned when calling get_data(). By default the submit button is added to this list so that when we call get_data() we only get the persistent-related fields. To remove more fields, re-declare the protected static $fieldstoremove class variable.</p>
<div class="highlight"><pre><span></span><code><span class="x">/** @var array Fields to remove when getting the final data. */</span>
<span class="x">protected static $fieldstoremove = array(&#39;submitbutton&#39;, &#39;areyouhappy&#39;);</span>
</code></pre></div>
<p>Do not forget to add the submitbutton back in there.</p>
<h5 id="fields-to-validate">Fields to validate</h5>
<p>What about when we have a legit field but it does not belong to the persistent? We still want to validate it ourselves, but we don't want it to be validated by the persistent as it will cause an error. In that case we define it in the protected static $foreignfields class variable.</p>
<div class="highlight"><pre><span></span><code><span class="x">/** @var array Fields to remove from the persistent validation. */</span>
<span class="x">protected static $foreignfields = array(&#39;updatedelay&#39;);</span>
</code></pre></div>
<p>Now the persistent will not validate this field, and we will get the updatedelay value when we call get_data(). Just don't forget to remove it before you feed the data to your persistent.</p>
<div class="highlight"><pre><span></span><code><span class="x">if (($data = $form-&gt;get_data())) {</span>
<span class="x">    $updatedelay = $data-&gt;updatedelay;</span>
<span class="x">    unset($data-&gt;updatedelay);</span>
<span class="x">    $newpersistent = new status(0, $data);</span>
<span class="x">}</span>
</code></pre></div>
<p>This method is particularily useful when dealing with file managers.</p>
<h4 id="grouping-fields">Grouping fields</h4>
<p>There is a little bit of work to do when you want to group some properties together. Let's imagine that we are asking our users to pick amongst a few verbs and food. They can only tell us if they like or dislike something and what it is. Our form should display both the verb and the food next to each other, and to do so we need to use a group.</p>
<p>First, let's update our persistent with the new two values we will store:</p>
<div class="highlight"><pre><span></span><code><span class="x">protected static function define_properties() {</span>
<span class="x">    ...</span>

<span class="x">        &#39;verb&#39; =&gt; array(</span>
<span class="x">            &#39;type&#39; =&gt; PARAM_ALPHANUM,</span>
<span class="x">            &#39;default&#39; =&gt; &#39;love&#39;</span>
<span class="x">        ),</span>
<span class="x">        &#39;food&#39; =&gt; array(</span>
<span class="x">            &#39;type&#39; =&gt; PARAM_ALPHANUM,</span>
<span class="x">            &#39;default&#39; =&gt; &#39;pizza&#39;</span>
<span class="x">        )</span>

<span class="x">    ...</span>
<span class="x">}</span>
</code></pre></div>
<p>Secondly, we must add the group to the form:</p>
<div class="highlight"><pre><span></span><code><span class="x">public function definition() {</span>
<span class="x">    ...</span>

<span class="x">    // Food I like.</span>
<span class="x">    $elements = [];</span>
<span class="x">    $elements[] = $mform-&gt;createElement(&#39;select&#39;, &#39;verb&#39;, &#39;verb&#39;, [</span>
<span class="x">        &#39;hate&#39; =&gt; &#39;I hate&#39;,</span>
<span class="x">        &#39;dislike&#39; =&gt; &#39;I dislike&#39;,</span>
<span class="x">        &#39;like&#39; =&gt; &#39;I like&#39;,</span>
<span class="x">        &#39;love&#39; =&gt; &#39;I love&#39;</span>
<span class="x">    ]);</span>
<span class="x">    $elements[] = $mform-&gt;createElement(&#39;select&#39;, &#39;food&#39;, &#39;Food&#39;, [</span>
<span class="x">        &#39;egg&#39; =&gt; &#39;Egg&#39;,</span>
<span class="x">        &#39;tofu&#39; =&gt; &#39;Tofu&#39;,</span>
<span class="x">        &#39;chicken&#39; =&gt; &#39;Chicken&#39;,</span>
<span class="x">        &#39;fish&#39; =&gt; &#39;Fish&#39;,</span>
<span class="x">        &#39;pizza&#39; =&gt; &#39;Pizza&#39;</span>
<span class="x">    ]);</span>
<span class="x">    $mform-&gt;addElement(&#39;group&#39;, &#39;foodilike&#39;, &#39;Food I like&#39;, $elements);</span>

<span class="x">    ...</span>
<span class="x">}</span>
</code></pre></div>
<p>If you were to try the code like this, you would get an error telling you that the persistent did not expect to receive the property foodilike. That's normal because the group is being set to the persistent which does not know what to do with it. In order to counter this we will need to convert the group to individual properties by extending the method convert_fields(stdClass $data).</p>
<div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * Convert fields.</span>
<span class="x"> *</span>
<span class="x"> * @param stdClass $data The data.</span>
<span class="x"> * @return stdClass</span>
<span class="x"> */</span>
<span class="x">protected static function convert_fields(stdClass $data) {</span>
<span class="x">    $data = parent::convert_fields($data);</span>

<span class="x">    // Convert the group to single properties.</span>
<span class="x">    $data-&gt;verb = $data-&gt;foodilike[&#39;verb&#39;];</span>
<span class="x">    $data-&gt;food = $data-&gt;foodilike[&#39;food&#39;];</span>
<span class="x">    unset($data-&gt;foodilike);</span>

<span class="x">    return $data;</span>
<span class="x">}</span>
</code></pre></div>
<p>Now it works because we've converted our group to individual properties. Note that you must call the parent method because we're automatically doing the same thing for you when you're using a text editor field.</p>
<p>While this works fine, this is not enough as when we load an existing object we must perform the same thing the other way around. We must convert the fields from our persistent to what the group field is expecting. To do so we override the method get_default_value(). We're also taking care of the text editor for you here so don't forget to call the parent.</p>
<p><div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * Get the default data.</span>
<span class="x"> *</span>
<span class="x"> * @return stdClass</span>
<span class="x"> */</span>
<span class="x">protected function get_default_data() {</span>
<span class="x">    $data = parent::get_default_data();</span>

<span class="x">    // Convert the single properties into a group.</span>
<span class="x">    $data-&gt;foodilike = [</span>
<span class="x">        &#39;verb&#39; =&gt; $data-&gt;verb,</span>
<span class="x">        &#39;food&#39; =&gt; $data-&gt;food,</span>
<span class="x">    ];</span>
<span class="x">    unset($data-&gt;verb);</span>
<span class="x">    unset($data-&gt;food);</span>

<span class="x">    return $data;</span>
<span class="x">}</span>
</code></pre></div>
You should now notice that the default values are set to "I love" and "Pizza". And we're done!</p>
<h3 id="examples">Examples</h3>
<h4 id="minimalist">Minimalist</h4>
<div class="highlight"><pre><span></span><code><span class="x">class status_form extends \core\form\persistent {</span>

<span class="x">    /** @var string Persistent class name. */</span>
<span class="x">    protected static $persistentclass = &#39;example\\status&#39;;</span>

<span class="x">    /**</span>
<span class="x">     * Define the form.</span>
<span class="x">     */</span>
<span class="x">    public function definition() {</span>
<span class="x">        $mform = $this-&gt;_form;</span>

<span class="x">        // User ID.</span>
<span class="x">        $mform-&gt;addElement(&#39;hidden&#39;, &#39;userid&#39;);</span>
<span class="x">        $mform-&gt;setConstant(&#39;userid&#39;, $this-&gt;_customdata[&#39;userid&#39;]);</span>

<span class="x">        // Message.</span>
<span class="x">        $mform-&gt;addElement(&#39;editor&#39;, &#39;message&#39;, &#39;Message&#39;);</span>

<span class="x">        // Location.</span>
<span class="x">        $mform-&gt;addElement(&#39;text&#39;, &#39;location&#39;, &#39;Location&#39;);</span>

<span class="x">        $this-&gt;add_action_buttons();</span>
<span class="x">    }</span>

<span class="x">}</span>
</code></pre></div>
<h4 id="more-advanced">More advanced</h4>
<div class="highlight"><pre><span></span><code><span class="x">class status_form extends \core\form\persistent {</span>

<span class="x">    /** @var string Persistent class name. */</span>
<span class="x">    protected static $persistentclass = &#39;example\\status&#39;;</span>

<span class="x">    /** @var array Fields to remove when getting the final data. */</span>
<span class="x">    protected static $fieldstoremove = array(&#39;submitbutton&#39;, &#39;areyouhappy&#39;);</span>

<span class="x">    /** @var array Fields to remove from the persistent validation. */</span>
<span class="x">    protected static $foreignfields = array(&#39;updatedelay&#39;);</span>

<span class="x">    /**</span>
<span class="x">     * Define the form.</span>
<span class="x">     */</span>
<span class="x">    public function definition() {</span>
<span class="x">        $mform = $this-&gt;_form;</span>

<span class="x">        // User ID.</span>
<span class="x">        $mform-&gt;addElement(&#39;hidden&#39;, &#39;userid&#39;);</span>
<span class="x">        $mform-&gt;setConstant(&#39;userid&#39;, $this-&gt;_customdata[&#39;userid&#39;]);</span>

<span class="x">        // Message.</span>
<span class="x">        $mform-&gt;addElement(&#39;editor&#39;, &#39;message&#39;, &#39;Message&#39;);</span>

<span class="x">        // Location.</span>
<span class="x">        $mform-&gt;addElement(&#39;text&#39;, &#39;location&#39;, &#39;Location&#39;);</span>

<span class="x">        // Status update delay.</span>
<span class="x">        $mform-&gt;addElement(&#39;duration&#39;, &#39;updatedelay&#39;, &#39;Status update delay&#39;);</span>

<span class="x">        // Are you happy?</span>
<span class="x">        $mform-&gt;addElement(&#39;selectyesno&#39;, &#39;areyouhappy&#39;, &#39;Are you happy?&#39;);</span>

<span class="x">        $this-&gt;add_action_buttons();</span>
<span class="x">    }</span>

<span class="x">    /**</span>
<span class="x">     * Extra validation.</span>
<span class="x">     *</span>
<span class="x">     * @param  stdClass $data Data to validate.</span>
<span class="x">     * @param  array $files Array of files.</span>
<span class="x">     * @param  array $errors Currently reported errors.</span>
<span class="x">     * @return array of additional errors, or overridden errors.</span>
<span class="x">     */</span>
<span class="x">    protected function extra_validation($data, $files, array &amp;$errors) {</span>
<span class="x">        $newerrors = array();</span>

<span class="x">        if ($data-&gt;location === &#39;SFO&#39;) {</span>
<span class="x">            $newerrors[&#39;location&#39;] = &#39;San-Francisco Airport is not accepted from the form.&#39;;</span>
<span class="x">        }</span>

<span class="x">        return $newerrors;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<h4 id="using-the-form">Using the form</h4>
<p>Consider the following code to be a page the users will access at '/example.php'.</p>
<div class="highlight"><pre><span></span><code><span class="x">require &#39;config.php&#39;;</span>

<span class="x">// Check if we go an ID.</span>
<span class="x">$id = optional_param(&#39;id&#39;, null, PARAM_INT);</span>

<span class="x">// Set the PAGE URL (and mandatory context). Note the ID being recorded, this is important.</span>
<span class="x">$PAGE-&gt;set_context(context_system::instance());</span>
<span class="x">$PAGE-&gt;set_url(new moodle_url(&#39;/example.php&#39;, [&#39;id&#39; =&gt; $id]));</span>

<span class="x">// Instantiate a persistent object if we received an ID. Typically receiving an ID</span>
<span class="x">// means that we are going to be updating an object rather than creating a new one.</span>
<span class="x">$persistent = null;</span>
<span class="x">if (!e mpty($id)) {</span>
<span class="x">    $persistent = new status($id);</span>
<span class="x">}</span>

<span class="x">// Create the form instance. We need to use the current URL and the custom data.</span>
<span class="x">$customdata = [</span>
<span class="x">    &#39;persistent&#39; =&gt; $persistent,</span>
<span class="x">    &#39;userid&#39; =&gt; $USER-&gt;id         // For the hidden userid field.</span>
<span class="x">];</span>
<span class="x">$form = new status_form($PAGE-&gt;url-&gt;out(false), $customdata);</span>

<span class="x">// Get the data. This ensures that the form was validated.</span>
<span class="x">if (($data = $form-&gt;get_data())) {</span>

<span class="x">    try {</span>
<span class="x">        if (empty($data-&gt;id)) {</span>
<span class="x">            // If we don&#39;t have an ID, we know that we must create a new record.</span>
<span class="x">            // Call your API to create a new persistent from this data.</span>
<span class="x">            // Or, do the following if you don&#39;t want capability checks (discouraged).</span>
<span class="x">            $persistent = new status(0, $data);</span>
<span class="x">            $persistent-&gt;create();</span>
<span class="x">        } else {</span>
<span class="x">            // We had an ID, this means that we are going to update a record.</span>
<span class="x">            // Call your API to update the persistent from the data.</span>
<span class="x">            // Or, do the following if you don&#39;t want capability checks (discouraged).</span>
<span class="x">            $persistent-&gt;from_record($data);</span>
<span class="x">            $persistent-&gt;update();</span>
<span class="x">        }</span>
<span class="x">        \core\notification::success(get_string(&#39;changessaved&#39;));</span>
<span class="x">    } catch (Exception $e) {</span>
<span class="x">        \core\notification::error($e-&gt;getMessage());</span>
<span class="x">    }</span>

<span class="x">    // We are done, so let&#39;s redirect somewhere.</span>
<span class="x">    redirect(new moodle_url(&#39;/&#39;));</span>
<span class="x">}</span>

<span class="x">// Display the mandatory header and footer.</span>
<span class="x">// And display the form, and its validation errors if there are any.</span>
<span class="x">echo $OUTPUT-&gt;header();</span>
<span class="x">$form-&gt;display();</span>
<span class="x">echo $OUTPUT-&gt;footer();</span>
</code></pre></div>
<p>The <code>core\form\persistent</code> class in Moodle offers a powerful and efficient way to connect forms with the Persistent API. It automates the process of handling form data, ensuring that it is correctly validated and saved to the database. This approach reduces boilerplate code, improves consistency, and simplifies the development of complex forms that interact with Moodle’s database.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../phpMoodleServices/" class="md-footer__link md-footer__link--prev" aria-label="Previous: External Services" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              External Services
            </div>
          </div>
        </a>
      
      
        
        <a href="../phpMoodleExporter/" class="md-footer__link md-footer__link--next" aria-label="Next: Exporter" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Exporter
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/ArceLopera" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://linkedin.com/in/carlos-arcelopera" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/ArceLopera" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    <a href="mailto:arcelopera.carlos@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m511.6 36.86-64 415.1a32.008 32.008 0 0 1-31.65 27.147c-4.188 0-8.319-.815-12.29-2.472l-122.6-51.1-50.86 76.29C226.3 508.5 219.8 512 212.8 512c-11.5 0-20.8-9.3-20.8-20.8v-96.18c0-7.115 2.372-14.03 6.742-19.64L416 96 122.3 360.3 19.69 317.5C8.438 312.8.812 302.2.062 289.1s5.47-23.72 16.06-29.77l448-255.1c10.69-6.109 23.88-5.547 34 1.406S513.5 24.72 511.6 36.86z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.expand"], "search": "../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>